<!-- Dashboard View - Figma Style -->
<style>
.dashboard-viewport {
  background: var(--background-dark);
  min-height: 100vh;
  min-width: 100vw;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 0;
  height: auto;
  padding-bottom: 32px;
  overflow: hidden;
}
@media (min-width: 431px) {
  .dashboard-viewport {
    width: 430px;
    min-width: 430px;
    max-width: 430px;
    min-height: 900px;
    max-height: none;
    margin: 32px auto;
    border-radius: 32px 32px 32px 32px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    position: relative;
    left: 0; right: 0;
  }
}
.dashboard-header {
  background: var(--primary-color);
  color: #fff;
  border-radius: 0 !important;
  margin-bottom: 12px;
  box-sizing: border-box;
  padding: 24px 0 16px 0;
  text-align: center;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.dashboard-header-inner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 90%;
  max-width: 340px;
}
.dashboard-profile-img {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: 3px solid #fff;
  object-fit: cover;
  background: #fff;
}
.dashboard-header-name {
  font-size: 1.5rem;
  font-weight: bold;
  color: #fff;
  margin: 0 12px;
  flex: 1;
  text-align: left;
}
.dashboard-header-gear {
  font-size: 2.2rem;
  color: #fff;
  cursor: pointer;
  background: none;
  border: none;
  outline: none;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.dashboard-header-gear .bi {
  color: #fff !important;
}
.dashboard-header-logout {
  font-size: 2.2rem;
  color: #fff;
  cursor: pointer;
  background: none;
  border: none;
  outline: none;
  padding: 0 0 0 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.dashboard-header-logout .bi {
  color: #fff !important;
}
.saldo-cards {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 24px;
  margin-bottom: 8px;
  width: 100%;
  max-width: 340px;
  margin-left: auto;
  margin-right: auto;
}
.saldo-card {
  background: #232323;
  border-radius: 16px;
  flex: 1;
  text-align: center;
  padding: 18px 0;
  min-width: 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.saldo-label {
  color: #fff;
  font-size: 1.1rem;
  font-weight: 500;
  margin-bottom: 4px;
  white-space: nowrap;
}
.saldo-value {
  color: var(--primary-color);
  font-size: 2rem;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 6px;
  justify-content: center;
}
.saldo-pontos-icon {
  width: 28px;
  height: 28px;
  object-fit: contain;
  margin-left: 4px;
  vertical-align: middle;
}
.saldo-cashback-label-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
}
.dashboard-cashback-msg {
  text-align: center;
  color: var(--secondary-color);
  margin: 12px 0 24px 0;
  font-size: 1rem;
}
.dashboard-cashback-msg span {
  color: var(--primary-color);
  font-weight: bold;
}
.dashboard-menu {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 100%;
  max-width: 340px;
  margin: 0 auto;
}
.dashboard-menu-btn {
  background: #232323;
  color: var(--primary-color);
  font-weight: 500;
  font-size: 1.1rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  border-radius: 16px;
  justify-content: center;
  border: none;
  padding: 18px 0 10px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  cursor: pointer;
  transition: background 0.18s;
}
.dashboard-menu-btn:active,
.dashboard-menu-btn:focus {
  background: #181818;
}
.dashboard-menu-icon {
  font-size: 1.7rem;
  color: var(--primary-color);
  margin-bottom: 2px;
}
.points-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 14px 4px 10px;
  background: #181818;
  border-radius: 999px;
  border: 1.5px solid #ec0677;
  color: #fff;
  font-weight: bold;
  font-size: 1.1em;
  margin-right: 4px;
  min-width: 48px;
  text-align: right;
}
.points-pill .bi-coin {
  color: #ec0677;
  font-size: 1.1em;
}
.dashboard-card {
  background: #232323;
  border-radius: 16px;
  margin-bottom: 16px;
  padding: 16px 0 12px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: background 0.18s;
}
.dashboard-card:hover {
  background: #292929;
}
.dashboard-card-title {
  font-weight: bold;
  color: var(--primary-color);
  font-size: 1.15rem;
  margin-bottom: 8px;
  text-align: center;
}
.dashboard-card-content {
  display: grid;
  grid-template-columns: 1fr 2fr 1fr;
  align-items: center;
  width: 100%;
  margin-top: 8px;
  margin-bottom: 8px;
}
.dashboard-card-img {
  width: 80px;
  height: 80px;
  border-radius: 16px;
  background: #fff;
  object-fit: contain;
  justify-self: center;
}
.points-pill {
  justify-self: end;
}
.fidelidade-btn {
  background: #232323;
  color: #ff2e93;
}
@keyframes pop-in {
  0% { transform: scale(0.7) translateY(40px); opacity: 0; }
  60% { transform: scale(1.08) translateY(-8px); opacity: 1; }
  100% { transform: scale(1) translateY(0); opacity: 1; }
}
</style>
<div ng-include="'views/modal/tutorialModal.html'" ng-if="vm.showTutorialModal"></div>
<div class="dashboard-viewport">
  <div ng-if="vm.successMessage" style="position:fixed;top:32px;left:50%;transform:translateX(-50%);z-index:1000;background:#232323;color:#fff;padding:18px 32px;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.18);font-size:1.25rem;font-weight:bold;display:flex;align-items:center;gap:12px;animation:pop-in 0.4s cubic-bezier(.4,2,.6,1);max-width:340px;text-align:center;">
    <i class="bi bi-check-circle-fill" style="color:#ff2e93;font-size:1.7rem;"></i>
    {{vm.successMessage}}
  </div>
  <!-- Header -->
  <div class="dashboard-header">
    <div class="dashboard-header-inner">
      <img class="dashboard-profile-img" ng-src="{{
        (vm.playerStatus.image && vm.playerStatus.image.medium && vm.playerStatus.image.medium.url) ||
        (vm.playerStatus.level && vm.playerStatus.level.image && vm.playerStatus.level.image.medium && vm.playerStatus.level.image.medium.url) ||
        'https://my.funifier.com/images/funny.png'
      }}" alt="Foto de Perfil">
      <span class="dashboard-header-name">Olá, {{vm.playerStatus.name || 'Jogador'}}!</span>
      <button class="dashboard-header-gear" ng-click="vm.goToProfile()" aria-label="Editar Perfil">
        <i class="bi bi-gear"></i>
      </button>
      <button class="dashboard-header-logout" ng-click="vm.logout()" aria-label="Sair" title="Sair">
        <i class="bi bi-box-arrow-right"></i>
      </button>
    </div>
  </div>
  <!-- Saldo Cards -->
  <div class="saldo-cards">
    <div class="saldo-card">
      <div class="saldo-label">Saldo Pontos</div>
      <div class="saldo-value">
        {{vm.playerStatus.point_categories.pontos || 0}}
        <img class="saldo-pontos-icon" src="https://imagizer.imageshack.com/img923/1336/ygZCtF.png" alt="Pontos" />
      </div>
    </div>
    <div class="saldo-card" ng-click="vm.goToCashbackCoupon()" style="cursor:pointer;">
      <div class="saldo-cashback-label-row">
        <div class="saldo-label">Saldo Cashback</div>
      </div>
      <div class="saldo-value" style="font-size:1.7rem;">
        R$ {{vm.cashbackReais | number:2}}
      </div>
    </div>
  </div>
  <div class="dashboard-cashback-msg" ng-if="vm.daysToCashbackExpiry > 0">
    Seu cashback expirará em <span>{{vm.daysToCashbackExpiry}} dias</span>
  </div>
  <!-- Menu Buttons -->
  <div class="dashboard-menu">
    <button class="dashboard-menu-btn" ng-repeat="btn in vm.dashboardButtons" ng-click="vm.handleDashboardButton(btn)">
      <i class="bi {{btn.icon}} dashboard-menu-icon" ng-style="{'color': btn.icon === 'bi-puzzle' ? '#ff2e93' : ''}"></i>
      {{btn.label}}
    </button>
  </div>
  <!-- Accordion for QR Code, Challenges, and Purchases -->
  <div style="width: 100%; max-width: 340px; margin: 32px auto 0 auto;">
    <!-- QR Code Section -->
    <div class="saldo-card" style="margin-bottom: 12px;">
      <div class="dashboard-card-title">QR Code</div>
      <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="saldo-label" style="margin-bottom: 8px;">QR Code</div>
        <img ng-if="vm.qrReady" ng-src="{{vm.qrImgUrl}}" width="180" height="180" alt="QR Code" style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.10);">
        <div style="color: #aaa; font-size: 0.95em; margin-top: 8px;">Escaneie para acessar</div>
        <div ng-if="vm.referralCode" style="color: #ff2e93; font-size: 0.95em; margin-top: 4px; word-break: break-all;">
          Código de indicação: <span style="font-family: monospace;">{{vm.referralCode}}</span>
        </div>
      </div>
    </div>
    <!-- Completed Challenges Section -->
    <div class="saldo-card" style="margin-bottom: 12px;">
      <div class="dashboard-card-title">Desafios Concluídos</div>
      <ul style="list-style: none; padding: 0; margin: 0; color: #fff;">
        <li class="dashboard-card" ng-repeat="challenge in vm.completedChallengesDisplay | limitTo:5" ng-click="vm.openHistoryModal(challenge, 'challenge')">
          <div class="dashboard-card-title">{{challenge.name}}</div>
          <div class="dashboard-card-content">
            <div></div>
            <img ng-if="challenge.badge" ng-src="{{challenge.badge}}" alt="Badge" class="dashboard-card-img">
            <div class="points-pill">
              <i class="bi bi-coin"></i> {{challenge.misscoins | number:0}}
            </div>
          </div>
        </li>
        <li ng-if="vm.completedChallengesDisplay.length === 0" style="color: #aaa; text-align: center;">Nenhum desafio concluído ainda.</li>
        <li ng-if="vm.completedChallengesDisplay.length > 5" style="color: #aaa; font-size: 0.95em; text-align: right;">...e mais {{vm.completedChallengesDisplay.length-5}} desafios</li>
      </ul>
    </div>
    <!-- Purchase History Section -->
    <div class="saldo-card">
      <div class="dashboard-card-title">Histórico de Compras</div>
      <div ng-if="vm.purchaseHistoryDisplay.length">
        <ul style="list-style: none; padding: 0; margin: 0; color: #fff;">
          <li class="dashboard-card" ng-repeat="item in vm.purchaseHistoryDisplay | limitTo:5" ng-click="vm.openHistoryModal(item, 'purchase')">
            <div class="dashboard-card-title">{{item.name}}</div>
            <div class="dashboard-card-content">
              <div></div>
              <img ng-if="item.image" ng-src="{{item.image}}" alt="Item" class="dashboard-card-img">
              <div class="points-pill">
                <i class="bi bi-coin"></i> {{item.misscoins | number:0}}
              </div>
            </div>
          </li>
          <li ng-if="vm.purchaseHistoryDisplay.length > 5" style="color: #aaa; font-size: 0.95em; text-align: right;">...e mais {{vm.purchaseHistoryDisplay.length-5}} compras</li>
        </ul>
      </div>
      <div ng-if="!vm.purchaseHistoryDisplay.length" style="color: #aaa; text-align: center;">Nenhuma compra realizada ainda.</div>
    </div>
  </div>
  <div ng-if="dailyLoginPopup" style="position:fixed;bottom:32px;right:32px;z-index:9999;background:#232323;color:#fff;padding:18px 32px;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.18);font-size:1.25rem;font-weight:bold;display:flex;align-items:center;gap:12px;animation:pop-in 0.4s cubic-bezier(.4,2,.6,1);">
    <i class="bi bi-check-circle-fill" style="color:#ff2e93;font-size:1.7rem;"></i>
    {{vm.dailyLoginMessage}}
  </div>
  <!-- History Modal -->
  <div ng-if="vm.historyModalOpen" class="modal-backdrop" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.6);z-index:9999;display:flex;align-items:center;justify-content:center;">
    <div class="modal-content" style="background:#232323;padding:32px 24px;border-radius:16px;max-width:400px;max-height:80vh;overflow:auto;min-width:280px;">
      <div style="font-weight:bold;font-size:1.2em;margin-bottom:18px;">Detalhes do Histórico</div>
      <div ng-if="vm.historyModalLoading" style="color:#ff2e93;text-align:center;font-size:1.1em;">Carregando...</div>
      <div ng-if="!vm.historyModalLoading && vm.historyModalData">
        <div style="margin-bottom:10px;"><b>Nome:</b> {{vm.historyModalData.name}}</div>
        <div ng-if="vm.historyModalData.image"><img ng-src="{{vm.historyModalData.image}}" alt="Imagem" style="width:64px;height:64px;border-radius:12px;background:#fff;margin-bottom:8px;"></div>
        <div ng-if="vm.historyModalData.badge"><img ng-src="{{vm.historyModalData.badge}}" alt="Badge" style="width:48px;height:48px;border-radius:12px;background:#fff;margin-bottom:8px;"></div>
        <div ng-if="vm.historyModalData.value"><b>Valor:</b> {{vm.historyModalData.value}}</div>
        <div ng-if="vm.historyModalData.date"><b>Data:</b> {{vm.historyModalData.date | date:'dd/MM/yyyy HH:mm'}}</div>
        <div ng-if="vm.historyModalData.description"><b>Descrição:</b> {{vm.historyModalData.description}}</div>
        <div ng-if="!vm.historyModalData.value && !vm.historyModalData.date && !vm.historyModalData.description" style="color:#aaa;">Sem informações adicionais.</div>
        <div ng-if="vm.historyModalData.extra && !vm.historyModalData.value && !vm.historyModalData.date" style="color:#aaa;font-size:0.95em;margin-top:10px;">Dados brutos: <pre style="background:#181818;color:#fff;padding:8px 12px;border-radius:8px;overflow-x:auto;">{{vm.historyModalData.extra | json}}</pre></div>
      </div>
      <div ng-if="!vm.historyModalLoading && !vm.historyModalData" style="color:#aaa;">Nenhum detalhe encontrado.</div>
      <button class="admin-btn" style="margin-top:18px;" ng-click="vm.closeHistoryModal()">Fechar</button>
    </div>
  </div>
</div> 