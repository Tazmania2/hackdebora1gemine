<!-- Dashboard View - Figma Style -->
<style>
.dashboard-viewport {
  background: var(--background-dark);
  min-height: 100vh;
  min-width: 100vw;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 0;
  height: auto;
  padding-bottom: 32px;
  overflow: hidden;
}
@media (min-width: 431px) {
  .dashboard-viewport {
    width: 430px;
    min-width: 430px;
    max-width: 430px;
    min-height: 900px;
    max-height: none;
    margin: 32px auto;
    border-radius: 32px 32px 32px 32px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    position: relative;
    left: 0; right: 0;
  }
}
.dashboard-header {
  background: var(--primary-color);
  color: #fff;
  border-radius: 0 !important;
  margin-bottom: 12px;
  box-sizing: border-box;
  padding: 24px 0 16px 0;
  text-align: center;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.dashboard-header-inner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 90%;
  max-width: 340px;
}
.dashboard-profile-img {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: 3px solid #fff;
  object-fit: cover;
  background: #fff;
}
.dashboard-header-name {
  font-size: 1.5rem;
  font-weight: bold;
  color: #fff;
  margin: 0 12px;
  flex: 1;
  text-align: left;
}
.dashboard-header-gear {
  font-size: 2.2rem;
  color: #fff;
  cursor: pointer;
  background: none;
  border: none;
  outline: none;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.dashboard-header-gear .bi {
  color: #fff !important;
}
.saldo-cards {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 24px;
  margin-bottom: 8px;
  width: 100%;
  max-width: 340px;
  margin-left: auto;
  margin-right: auto;
}
.saldo-card {
  background: #232323;
  border-radius: 16px;
  flex: 1;
  text-align: center;
  padding: 18px 0;
  min-width: 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.saldo-label {
  color: #fff;
  font-size: 1.1rem;
  font-weight: 500;
  margin-bottom: 4px;
  white-space: nowrap;
}
.saldo-value {
  color: var(--primary-color);
  font-size: 2rem;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 6px;
  justify-content: center;
}
.saldo-pontos-icon {
  width: 28px;
  height: 28px;
  object-fit: contain;
  margin-left: 4px;
  vertical-align: middle;
}
.saldo-cashback-label-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
}
.dashboard-cashback-msg {
  text-align: center;
  color: var(--secondary-color);
  margin: 12px 0 24px 0;
  font-size: 1rem;
}
.dashboard-cashback-msg span {
  color: var(--primary-color);
  font-weight: bold;
}
.dashboard-menu {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 100%;
  max-width: 340px;
  margin: 0 auto;
}
.dashboard-menu-btn {
  background: #232323;
  color: var(--primary-color);
  font-weight: 500;
  font-size: 1.1rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  border-radius: 16px;
  justify-content: center;
  border: none;
  padding: 18px 0 10px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  cursor: pointer;
  transition: background 0.18s;
}
.dashboard-menu-btn:active,
.dashboard-menu-btn:focus {
  background: #181818;
}
.dashboard-menu-icon {
  font-size: 1.7rem;
  color: var(--primary-color);
  margin-bottom: 2px;
}
.points-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 14px 4px 10px;
  background: #181818;
  border-radius: 999px;
  border: 1.5px solid #ec0677;
  color: #fff;
  font-weight: bold;
  font-size: 1.1em;
  margin-right: 4px;
  min-width: 48px;
  text-align: right;
}
.points-pill .bi-coin {
  color: #ec0677;
  font-size: 1.1em;
}
.dashboard-card {
  background: #232323;
  border-radius: 16px;
  margin-bottom: 16px;
  padding: 16px 0 12px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: background 0.18s;
}
.dashboard-card:hover {
  background: #292929;
}
.dashboard-card-title {
  font-weight: bold;
  color: var(--primary-color);
  font-size: 1.15rem;
  margin-bottom: 8px;
  text-align: center;
}
.dashboard-card-content {
  display: grid;
  grid-template-columns: 1fr 2fr 1fr;
  align-items: center;
  width: 100%;
  margin-top: 8px;
  margin-bottom: 8px;
}
.dashboard-card-img {
  width: 80px;
  height: 80px;
  border-radius: 16px;
  background: #fff;
  object-fit: contain;
  justify-self: center;
}
.points-pill {
  justify-self: end;
}
</style>
<div class="dashboard-viewport">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="dashboard-header-inner">
      <img class="dashboard-profile-img" ng-src="{{
        (vm.playerStatus.image && vm.playerStatus.image.medium && vm.playerStatus.image.medium.url) ||
        (vm.playerStatus.level && vm.playerStatus.level.image && vm.playerStatus.level.image.medium && vm.playerStatus.level.image.medium.url) ||
        'https://my.funifier.com/images/funny.png'
      }}" alt="Foto de Perfil">
      <span class="dashboard-header-name">Olá, {{vm.playerStatus.name || 'Jogador'}}!</span>
      <button class="dashboard-header-gear" ng-click="vm.goToProfile()" aria-label="Editar Perfil">
        <i class="bi bi-gear"></i>
      </button>
    </div>
  </div>
  <!-- Saldo Cards -->
  <div class="saldo-cards">
    <div class="saldo-card">
      <div class="saldo-label">Saldo Pontos</div>
      <div class="saldo-value">
        {{vm.playerStatus.point_categories.pontos || 0}}
        <img class="saldo-pontos-icon" src="https://imagizer.imageshack.com/img923/1336/ygZCtF.png" alt="Pontos" />
      </div>
    </div>
    <div class="saldo-card">
      <div class="saldo-cashback-label-row">
        <div class="saldo-label">Saldo Cashback</div>
      </div>
      <div class="saldo-value" style="font-size:1.7rem;">
        R$ {{vm.playerStatus.point_categories.misscoins || 0}}
      </div>
    </div>
  </div>
  <div class="dashboard-cashback-msg">
    Seu cashback expirará em <span>10 dias</span>
  </div>
  <!-- Menu Buttons -->
  <div class="dashboard-menu">
    <button class="dashboard-menu-btn" ng-click="vm.goToEvents()">
      <i class="bi bi-calendar-event dashboard-menu-icon"></i>
      Próximos eventos
    </button>
    <button class="dashboard-menu-btn" ng-click="vm.goToFidelidade()">
      <i class="bi bi-patch-check dashboard-menu-icon"></i>
      Registre sua compra
    </button>
    <button class="dashboard-menu-btn" ng-click="vm.goToStore()">
      <i class="bi bi-shop dashboard-menu-icon"></i>
      Loja
    </button>
    <button class="dashboard-menu-btn" ng-click="vm.goToSocial()">
      <i class="bi bi-hash dashboard-menu-icon"></i>
      Rede Social
    </button>
    <button class="dashboard-menu-btn" ng-click="vm.goToHistory()">
      <i class="bi bi-clock-history dashboard-menu-icon"></i>
      Histórico de Resgate
    </button>
    <button class="dashboard-menu-btn" ng-click="vm.goToQuiz()">
      <i class="bi bi-chat-dots dashboard-menu-icon"></i>
      Quiz - Teste seu conhecimento!
    </button>
  </div>
  <!-- Accordion for QR Code, Challenges, and Purchases -->
  <div style="width: 100%; max-width: 340px; margin: 32px auto 0 auto;">
    <uib-accordion close-others="true">
      <!-- QR Code Accordion -->
      <div uib-accordion-group heading="QR Code" is-open="status.open1" class="saldo-card" style="margin-bottom: 12px;">
        <div style="display: flex; flex-direction: column; align-items: center;">
          <div class="saldo-label" style="margin-bottom: 8px;">QR Code</div>
          <img ng-if="vm.qrReady" ng-src="{{vm.qrImgUrl}}" width="180" height="180" alt="QR Code" style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.10);">
          <div style="color: #aaa; font-size: 0.95em; margin-top: 8px;">Escaneie para acessar</div>
        </div>
      </div>
      <!-- Completed Challenges Accordion -->
      <div uib-accordion-group heading="Desafios Concluídos" is-open="true" class="saldo-card" style="margin-bottom: 12px;">
        <ul style="list-style: none; padding: 0; margin: 0; color: #fff;">
          <li class="dashboard-card" ng-repeat="challenge in vm.completedChallengesDisplay | limitTo:5" ng-click="vm.goToChallenge(challenge)">
            <div class="dashboard-card-title">{{challenge.name}}</div>
            <div class="dashboard-card-content">
              <div></div>
              <img ng-if="challenge.badge" ng-src="{{challenge.badge}}" alt="Badge" class="dashboard-card-img">
              <div class="points-pill">
                <i class="bi bi-coin"></i> {{challenge.misscoins}}
              </div>
            </div>
          </li>
          <li ng-if="vm.completedChallengesDisplay.length === 0" style="color: #aaa; text-align: center;">Nenhum desafio concluído ainda.</li>
          <li ng-if="vm.completedChallengesDisplay.length > 5" style="color: #aaa; font-size: 0.95em; text-align: right;">...e mais {{vm.completedChallengesDisplay.length-5}} desafios</li>
        </ul>
      </div>
      <!-- Purchase History Accordion -->
      <div uib-accordion-group heading="Histórico de Compras" is-open="status.open3" class="saldo-card">
        <div ng-if="vm.purchaseHistoryDisplay.length">
          <ul style="list-style: none; padding: 0; margin: 0; color: #fff;">
            <li class="dashboard-card" ng-repeat="item in vm.purchaseHistoryDisplay | limitTo:5" ng-click="vm.goToPurchase(item)">
              <div class="dashboard-card-title">{{item.name}}</div>
              <div class="dashboard-card-content">
                <div></div>
                <img ng-if="item.image" ng-src="{{item.image}}" alt="Item" class="dashboard-card-img">
                <div class="points-pill">
                  <i class="bi bi-coin"></i> {{item.misscoins}}
                </div>
              </div>
            </li>
            <li ng-if="vm.purchaseHistoryDisplay.length > 5" style="color: #aaa; font-size: 0.95em; text-align: right;">...e mais {{vm.purchaseHistoryDisplay.length-5}} compras</li>
          </ul>
        </div>
        <div ng-if="!vm.purchaseHistoryDisplay.length" style="color: #aaa; text-align: center;">Nenhuma compra realizada ainda.</div>
      </div>
    </uib-accordion>
  </div>
</div> 